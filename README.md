# JoPDF Reader

一个基于 Qt 和 MuPDF 的现代化 PDF 阅读器，采用模块化架构设计，目标是提供流畅的阅读体验和强大的功能。

## ✨ 主要特性

### 📖 阅读功能
- **多种显示模式**：单页、双页、连续滚动
- **灵活缩放**：适应页面、适应宽度、自定义缩放（25% - 400%）
- **多标签页**：同时打开多个 PDF 文档

### 🔍 交互功能
- **全文搜索**：支持大小写敏感、全字匹配
- **文本选择**：字符级、单词、整行选择
- **链接支持**：内部跳转和外部链接
- **导航面板**：目录大纲、缩略图预览

### 📝 高级功能
- **大纲编辑**：添加、删除、重命名书签
- **智能缓存**：基于 LRU 的页面缓存策略
- **文本预加载**：后台异步提取文本
- **PDF 类型识别**：自动识别文本 PDF 和扫描 PDF

### 🎨 用户界面
- **现代化设计**：参考 PDF Expert 的简洁风格
- **响应式布局**：自适应窗口大小变化
- **快捷键支持**：完整的键盘导航
- **工具栏**：直观的操作按钮和状态显示

## 🏗️ 架构设计

### 核心模块

```
JoPDF
├── Controller 层 (会话管理)
│   └── PDFDocumentSession - 文档会话管理
├── Handler 层 (功能处理)
│   ├── PDFViewHandler - 视图状态管理
│   ├── PDFContentHandler - 内容管理
│   └── PDFInteractionHandler - 交互处理
├── Manager 层 (资源管理)
│   ├── PageCacheManager - 页面缓存
│   ├── TextCacheManager - 文本缓存
│   ├── ThumbnailManager - 缩略图管理
│   ├── OutlineManager - 大纲管理
│   ├── SearchManager - 搜索管理
│   └── LinkManager - 链接管理
├── Renderer 层 (渲染引擎)
│   └── MuPDFRenderer - MuPDF 渲染封装
└── UI 层 (用户界面)
    ├── MainWindow - 主窗口
    ├── PDFDocumentTab - 文档标签页
    ├── PDFPageWidget - 页面显示组件
    ├── NavigationPanel - 导航面板
    └── SearchWidget - 搜索工具栏
```

### 设计模式

- **依赖注入**：Handler 层通过构造函数注入依赖
- **职责分离**：每个 Handler 负责特定功能域
- **观察者模式**：使用 Qt 信号槽机制
- **策略模式**：缓存策略、缩放模式
- **单例模式**：应用配置管理


## 📚 使用说明

### 基本操作

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 打开文件 | `Ctrl+O` | 打开 PDF 文档 |
| 新标签页打开 | `Ctrl+Shift+O` | 在新标签页中打开 |
| 关闭文档 | `Ctrl+W` | 关闭当前标签页 |
| 上一页 | `PgUp` | 翻到上一页 |
| 下一页 | `PgDown` | 翻到下一页 |
| 首页 | `Home` | 跳转到第一页 |
| 末页 | `End` | 跳转到最后一页 |

### 缩放操作

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 放大 | `Ctrl++` | 放大显示 |
| 缩小 | `Ctrl+-` | 缩小显示 |
| 实际大小 | `Ctrl+0` | 100% 显示 |
| 适应页面 | `Ctrl+1` | 适应整页 |
| 适应宽度 | `Ctrl+2` | 适应宽度 |

### 搜索功能

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 打开搜索 | `Ctrl+F` | 显示搜索栏 |
| 查找下一个 | `F3` / `Ctrl+G` | 下一个匹配 |
| 查找上一个 | `Shift+F3` / `Ctrl+Shift+G` | 上一个匹配 |

### 文本操作

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 复制 | `Ctrl+C` | 复制选中文本 |
| 全选 | `Ctrl+A` | 选择当前页全部文本 |
| 取消选择 | `Esc` | 清除文本选择 |

### 视图切换

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 导航面板 | `F9` | 显示/隐藏导航面板 |
| 单页模式 | - | 一次显示一页 |
| 双页模式 | - | 一次显示两页 |
| 连续滚动 | - | 连续滚动所有页面 |

## 🔧 核心组件说明

### PDFDocumentSession

文档会话管理器，协调所有子系统：

```cpp
PDFDocumentSession session;
session.loadDocument("path/to/file.pdf");
session.setCurrentPage(5);
session.setZoomMode(ZoomMode::FitWidth);
```

### PDFViewHandler

管理视图状态（页面、缩放、显示模式）：

- 页面导航逻辑
- 缩放计算
- 连续滚动位置管理
- 双页模式处理

### PDFContentHandler

管理文档内容（大纲、缩略图）：

- 大纲加载与编辑
- 缩略图生成
- PDF 类型检测

### PDFInteractionHandler

处理用户交互（搜索、选择、链接）：

- 全文搜索
- 文本选择（字符/单词/行）
- 链接检测与跳转

### 缓存系统

**PageCacheManager**: LRU 页面缓存
- 自动管理内存使用
- 预加载可见页面周围内容
- 支持多种缓存策略

**TextCacheManager**: 文本提取缓存
- 后台异步预加载
- 提高搜索性能

## 📊 性能优化

### 缓存策略

1. **Near Current**: 优先缓存当前页附近
2. **LRU**: 最近最少使用淘汰
3. **内存限制**: 可配置最大缓存大小

### 渲染优化

- 按需渲染：只渲染可见页面
- 异步加载：后台线程生成缩略图
- 防抖动：窗口调整大小时延迟重新渲染

### 文本处理

- 懒加载：需要时才提取文本
- 预加载：后台提取未来可能需要的文本
- 缓存：避免重复提取


## 🐛 已知问题


### 代码规范

- 使用 Qt 编码风格
- 添加必要的注释
- 保持模块化设计


## 📄 许可证



## 🙏 致谢

- [MuPDF](https://mupdf.com/) - 强大的 PDF 渲染引擎
- [Qt Framework](https://www.qt.io/) - 跨平台应用框架
- PDF Expert - UI 设计灵感来源

## 📧 联系方式

- 项目主页: https://github.com/techfs2026/JoPDF

## 🌟 Star History

如果这个项目对你有帮助，请给个 Star ⭐️

---

**Made with ❤️ by @techfs**
